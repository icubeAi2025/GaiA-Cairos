<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>make login token</title>

    <script type="text/javascript" src="/assets/js/jquery-3.4.1.min.js"></script>
</head>
<body class="jui feather">

<div>
    <input type="text" placeholder="아이디를 입력하세요" id="id" value="kimbj@ideait.co.kr" />
</div>
<div>
    <label><input type="radio" name="platform" id="platform_oci" value="oci" checked>OCI</label>
    <label><input type="radio" name="platform" id="platform_ncp" value="ncp">NCP</label>
</div>
<div>
    <label><input type="radio" name="type" id="type_old" value="old" checked>OLD</label>
    <label><input type="radio" name="type" id="type_new" value="new">NEW</label>
</div>
<div>
    <input type="button" value="login" id="btnLogin" style="cursor:pointer;" onclick="doLogin()">
    <input type="button" value="test" id="btnTest" style="cursor:pointer;" onclick="doTest()">
</div>
</body>
<script>
    function setCookie(cookieName, value, exdays, domain, secureBool) {
        const exdate = new Date();
        exdate.setDate(exdate.getDate() + exdays);
        let cookieValue = encodeURIComponent(value) + "; path=/;";

        if (exdays) {
            cookieValue += " expires=" + exdate.toUTCString() + ";";
        }

        if (domain) {
            cookieValue += " domain=" + domain + ";";
        }

        if (secureBool === true) {
            cookieValue += " secure;";
        }

        document.cookie = cookieName + "=" + cookieValue;
    }

    doLogin = function () {
        setCookie('c-portal-auth', '', -1);
        setCookie('cairos-x-auth', '', -1);
        setCookie('IDPLSSOID', '', -1);
        setCookie('JSESSIONIDC', '', -1);
        setCookie('lang', '', -1);

        $.ajax({
            url: "/webApi/test/make-login-token",
            method: "POST",
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({
                platform: $('[name="platform"]:checked').val()
                , type: $('[name="type"]').val()
                , id: $('#id').val()
            }),
            success(resp) {
                // $.ajax({
                //     url: $('[name="platform"]').val() === 'oci' ? '/linkLogin' : '/ncpLogin',
                //     method: "get",
                //     // dataType: "json",
                //     // contentType: "application/json; charset=utf-8",
                //     success(resp) {
                //         location.href = '/';
                //     },
                //     error(error) {
                //     },
                // });
                location.href = $('[name="platform"]:checked').val() === 'oci' ? '/linkLogin' : '/ncpLogin';
            },
            error(error) {
                alert(error.responseJSON?.message);
            },
        });
    }

    doTest = function () {
        $.ajax({
            url: "/webApi/test/user-info",
            method: "get",
            dataType: "json",
            data: {
                id:  $('#id').val()
            },
            // contentType: "application/json; charset=utf-8",
            success(resp) {
            },
            error(error) {
            },
        });
    }

</script>
</html>
