<!doctype html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Document</title>

    <link type="text/css" rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" />

    <link rel="stylesheet" href="/assets/static/toast/zephyr-toast.css" />
    <link rel="stylesheet" href="/assets/static/toast/zephyr-toast-animate.css" />

    <script src="https://unpkg.com/vue@3.5.21"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script type="text/javascript" src="/assets/js/jquery-3.4.1.min.js"></script>

    <script src="/assets/static/toast/zephyr-toast.js"></script>

    <script src="/assets/static/tware/tware.class.js"></script>
    <script src="/assets/js/common/axios.common.js"></script>
    <script src="/assets/js/common/custom-components.js"></script>
    <script src="/assets/js/common.js"></script>
    <script src="/assets/js/gaia_common.js"></script>
    <script src="/assets/js/gaia-cairos.js"></script>


    <!-- 신규 CSS 적용 Start -->
    <link rel="stylesheet" href="/assets/css/common.css" />
    <link rel="stylesheet" href="/assets/css/content.css" />
    <link rel="stylesheet" href="/assets/css/icofonts.css" />
    <link rel="stylesheet" href="/assets/css/pretendard-subset.css" />
    <link rel="stylesheet" href="/assets/css/slick.css" />
    <link rel="stylesheet" href="/assets/css/component.css" />
    <link rel="stylesheet" href="/assets/css/custom.css" />
</head>
<body>
<!-- alert창 -->
<div class="pop_box toast" id="popBoxToast" style="display:none; position:absolute; z-index:50; opacity: 100 !important;">
    <span class="toast_msg"></span>
    <button type="button" class="icon_btn pop_close">
        <i class="ic ic-close"></i>
        <span class="blind">창닫기</span>
    </button>
</div>

<div class="g-group g-col2" style="grid-template-columns: 50% 50%;">
    <div class="group">
        <div class="s_conts">
            <span class="tree_route">사진 업로드</span><br>
            <input id="file" type="file" name="file" style="width:0; height:0; padding: 0">
            <span class="fileName" id="fileName">업로드 된 파일이 없습니다.</span>
            <!-- S: Slick Slider -->
            <div class="process_photo" style="margin-top:20px">
                <div class="rvw_dwg_photo" id="rvw_dwg_photo"></div>
                <div class="slick_nav">
                    <div class="btn_area">
                        <div class="btn_group _outline">
                            <button type="button" class="btn icon_btn" onclick="upload()">
                                <i class="ic ic-picture-one"></i>
                                <span class="blind">추가</span>
                            </button>
                            <button type="button" class="btn icon_btn" onclick="remove()">
                                <i class="ic ic-delete"></i>
                                <span class="blind">삭제</span>
                            </button>
                        </div>

                    </div>
                </div>
            </div>
            <button type="button" class="btn _fill" onclick="save()">저장</button>
        </div>
    </div>
</div>
<div class="thumbnail-box" style="width: 200px;">
    <img id="thumbnail" src="" alt=""/>
</div>
<div id="batchUploaderApp"></div>

<script>
    const fileTag = document.getElementById("file");
    const fileName = document.getElementById("fileName");
    let metas;
    fileTag.addEventListener("change", (event) => {
        const file = event.target.files[0];
        tware.utils.resizeImage(document.getElementById("thumbnail"),file,(response)=>{
            const resizedFile = response.file;
            const formData = new FormData();
            formData.append('files', resizedFile);
            gaiaCommon.postForm("/resource/upload",formData,(response)=>{
                metas = response.details.metas;
                fileName.textContent = gaiaCommon.decodeSafeText(metas[0].originalFilename);
            })
        })
    })
    function upload(){
        fileTag.click();
    }
    function save(){
        gaiaCommon.post("/webApi/test/upload",metas,(response)=>{
            console.log("이동 된 파일들!",response.details.movedFileMetas);
        })
    }
    function remove(){
        fileTag.value = "";
        fileName.textContent = '업로드 된 파일이 없습니다.';
        document.getElementById("thumbnail").src = "";

        //여기서는 meta 정보가 한 개 입니다. 실제로 for문은 1회만 반복합니다.
        for(const meta of metas){
            gaiaCommon.post("/resource/delete",meta,(response)=>{
                if(response.ok){
                    alert("temp 파일 삭제 성공!");
                }
            })
        }
    }
</script>
</body>
</html>