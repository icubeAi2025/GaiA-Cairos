{% extends 'layout/base_content' %} {% block content %}
<article class="conts g-row">
    <div class="group">
        <h3 class="conts_tit" id="title"></h3>
        <div class="conts_form">
            <div class="btn_area s_default _outline">
                {{ btnHtml | raw }}
                <button type="button" class="btn" id="close-popup" onclick="page.close()">
                    {{ message("btn.007") }}
                </button>
            </div>
            <form name="addForm" id="addForm">
                <div class="form_box readonly">
                    <!-- row -->
                    <div class="row cols2">
                        <div class="col">
                            <div class="form_label ">
                                    {{ message("item.org.005") }}
                            </div>
                            <div class="form_data" id="ofclNm">
                            </div>
                        </div>
                        <div class="col">
                            <div class="form_label">
                                {{ message("item.org.004") }}
                            </div>
                            <div class="form_data" id="cnsttyCdNm">
                            </div>
                        </div>
                    </div>
                    <!-- row -->
                    <div class="row cols2">
                        <div class="col">
                            <div class="form_label ">
                                    {{ message("item.org.003") }}
                            </div>
                            <div class="form_data">
                                <span class="item_wrap" id="corpNm">
                                </span>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form_label">
                                {{ message("item.org.006") }}
                            </div>
                            <div class="form_data" id="ofclTypeNm">
                            </div>
                        </div>
                    </div>
                    <!-- row -->
                    <div class="row cols2">
                        <div class="col">
                            <div class="form_label">
                                {{ message("item.org.007") }}
                            </div>
                            <div class="form_data" id="pstn">
                            </div>
                        </div>
                        <div class="col">
                            <div class="form_label">
                                {{ message("item.org.008") }}
                            </div>
                            <div class="form_data" id="telNo">
                            </div>
                        </div>
                    </div>
                    <!-- row -->
                    <div class="row cols2">
                        <div class="col">
                            <div class="form_label">
                                {{ message("item.org.009") }}
                            </div>
                            <div class="form_data" id="email">
                            </div>
                        </div>
                        <div class="col">
                            <div class="form_label ">
                                {{ message("item.com.003") }}
                            </div>
                            <div class="form_data" id="useYn">
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</article>
{% endblock content %} {% block footer_script %}

<script>
    const params = new URLSearchParams(window.location.search);
    let pjtNo;
    const cntrctNo = params.get("cntrctNo");
    const cntrctOrgId = params.get("cntrctOrgId");

    var popup = {
        data: { cntrctNo: cntrctNo },
        close: function () {
            $("#popup").html("");
        },
        add: function () {
            if (popup.data.corpNm) { $("#corpNm").val(popup.data.corpNm); }
            if (popup.data.ofclNm) { $("#ofclNm").val(popup.data.ofclNm); }
            $("#popup").html("");
        },

    }

    var page = {
        data: {
            init: ""
        },

        init() {
            pjtNo = pjtInfo.pjtNo;
            this.loadData(cntrctNo, cntrctOrgId);
            gaiaPortal.navMenuInit("M010102", "{{ message('item.org.014') }}");
            $("#menuDepth").append(`<li class="breadcrumb_item">{{ message('item.org.014') }}</li>`);
        },

        //닫기
        close: function () { window.location.replace(`/project/organization?pjtNo=${pjtNo}&cntrctNo=${pjtInfo.cntrctNo}`); sessionStorage.setItem('cntrctNo', cntrctNo); },

        // 조직 수정
        update: function () {
            window.location.href = `/project/organization/update?pjtNo=${pjtNo}&cntrctNo=${cntrctNo}&cntrctOrgId=${cntrctOrgId}`;
        },

        // 기본데이터
        loadData: function (cntrctNo, cntrctOrgId) {
            const url = "/api/project/organization/" + cntrctNo + "/" + cntrctOrgId;
            gaiaCommon.get(url, '', function (result){
                let data = result.details.organization;
                $("#corpNm").text(gaiaCommon.decodeSafeText(data.corpNm));
                $("#cnsttyCdNm").text(gaiaCommon.decodeSafeText(data.cnsttyCdNm));
                $("#ofclNm").text(gaiaCommon.decodeSafeText(data.ofclNm));
                $("#ofclTypeNm").text(gaiaCommon.decodeSafeText(data.ofclTypeNm));
                $("#pstn").text(gaiaCommon.decodeSafeText(data.pstn));
                $("#telNo").text(gaiaCommon.decodeSafeText(data.telNo));
                $("#email").text(data.email);
                $("#useYn").text(data.useYn === "Y" ? '{{ message("item.com.015") }}' : '{{ message("item.com.016") }}');
            }, function (error){
                console.error("Error loadData organization:", error);
            })
        },
    }

    $(function () {
        gaia.create({
            $init: function ($params) {
                page.init();

                gaia.loaded = true
            }
        });
    })
</script>
{% endblock footer_script %}